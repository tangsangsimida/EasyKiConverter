app-id: com.tangsangsimida.EasyKiConverter
runtime: org.kde.Platform
runtime-version: '6.6'
sdk: org.kde.Sdk
command: EasyKiConverter
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --share=network
  - --filesystem=home

modules:
  - name: easykiconverter
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DENABLE_SYMBOL_FOOTPRINT_DEBUG_EXPORT=OFF
      - -DCMAKE_INSTALL_PREFIX=/app
      - -DCMAKE_INSTALL_LIBDIR=/app/lib
      - -DCMAKE_INSTALL_BINDIR=/app/bin
      - -DCMAKE_INSTALL_DATADIR=/app/share
      - -DQT6_INSTALL_PREFIX=/app
      - -DQT6_INSTALL_LIBS=/app/lib
      - -DQT6_INSTALL_QML=/app/lib/qt6/qml
      - -DQT6_INSTALL_PLUGINS=/app/lib/qt6/plugins
      - -DQT6_INSTALL_TRANSLATIONS=/app/share/translations
    build-commands:
      - cmake --build . --parallel
      - cmake --install .
    post-install:
      - |
        # 确保所有必要的目录存在
        mkdir -p /app/lib/qt6/qml
        mkdir -p /app/lib/qt6/plugins
        mkdir -p /app/share/applications
        mkdir -p /app/share/icons/hicolor/256x256/apps
        
        # 创建 desktop 文件
        cat > /app/share/applications/com.tangsangsimida.EasyKiConverter.desktop <<EOF
        [Desktop Entry]
        Type=Application
        Name=EasyKiConverter
        Comment=Convert LCSC and EasyEDA components to KiCad libraries
        Exec=EasyKiConverter
        Icon=com.tangsangsimida.EasyKiConverter
        Categories=Development;Electronics;
        Terminal=false
        EOF
        
        # 复制图标
        cp /app/share/icons/app_icon.png /app/share/icons/hicolor/256x256/apps/com.tangsangsimida.EasyKiConverter.png
        
        # 更新桌面数据库
        update-desktop-database /app/share/applications || true
    sources:
      - type: dir
        path: ..
